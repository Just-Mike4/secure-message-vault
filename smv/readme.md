# Secure Message Vault API\n\n## Project Title\n**Secure Message Vault API**\n\n## Short Description\nThe Secure Message Vault API is a robust backend solution for storing and managing highly confidential messages. It provides advanced encryption capabilities, allowing users to securely store sensitive information that can be time-locked, protected by a passphrase, and even configured to self-destruct after a single viewing. Built with Django REST Framework, this API ensures data privacy and controlled access.\n\n## Features Overview\n\n*   **Strong Encryption:** Messages are encrypted server-side using the `cryptography` library, supporting both a system-wide master key and user-defined passphrases for decryption.\n*   **Time-Locked Messages:** Set a future date and time before which a message cannot be unlocked, ensuring information is revealed only when intended.\n*   **Passphrase Protection:** Enhance security by requiring a specific passphrase to decrypt and access a message.\n*   **Self-Destructing Messages:** Messages can be configured to automatically delete themselves from the vault immediately after being viewed for the first time.\n*   **User Authentication & Authorization:** Secure user registration, login, and token-based authentication (JWT) manage access to personal message vaults.\n*   **Password Management:** Includes functionality for initiating and confirming password resets via email.\n*   **RESTful API:** All functionalities are exposed through a clear and consistent RESTful API.\n\n## Installation Instructions\n\nTo set up and run the Secure Message Vault API locally, follow these steps:\n\n### Prerequisites\n*   Python 3.8+\n*   pip (Python package installer)\n\n### Steps\n\n1.  **Clone the Repository:**\n    ```bash\n    git clone <repository_url>\n    cd smv-project-directory # Replace with your actual directory name\n    ```\n\n2.  **Create and Activate a Virtual Environment:**\n    It's highly recommended to use a virtual environment to manage dependencies.\n    ```bash\n    python -m venv venv\n    # On Windows:\n    .\\venv\\Scripts\\activate\n    # On macOS/Linux:\n    source venv/bin/activate\n    ```\n\n3.  **Install Dependencies:**\n    Install all required Python packages using pip:\n    ```bash\n    pip install -r requirements.txt\n    ```\n\n4.  **Environment Configuration:**\n    Create a `.env` file in the root directory of the project (where `manage.py` is located) and add the following environment variables:\n    *   `MASTER_KEY`: A randomly generated base64-encoded URL-safe key for system-level encryption. You can generate one using Python:\n        ```python\n        from cryptography.fernet import Fernet\n        print(Fernet.generate_key().decode())\n        ```\n    *   **Email Configuration (for password reset):**\n        ```ini\n        EMAIL_HOST=smtp.your-email-provider.com\n        EMAIL_PORT=587 # Or 465 for SSL, adjust EMAIL_USE_TLS/SSL accordingly\n        EMAIL_USE_TLS=True # Or EMAIL_USE_SSL=True\n        EMAIL_HOST_USER=your_email@example.com\n        EMAIL_HOST_PASSWORD=your_email_password\n        ```\n\n5.  **Apply Database Migrations:**\n    Create the database schema and apply initial migrations:\n    ```bash\n    python manage.py makemigrations\n    python manage.py migrate\n    ```\n\n6.  **Create a Superuser (Optional but Recommended):**\n    This allows access to the Django Admin panel for database management.\n    ```bash\n    python manage.py createsuperuser\n    ```\n    Follow the prompts to create your admin user.\n\n7.  **Run the Development Server:**\n    Start the Django development server:\n    ```bash\n    python manage.py runserver\n    ```\n    The API will now be accessible at `http://127.0.0.1:8000/api/`.\n\n## Usage Examples\n\nThe API endpoints are designed to be intuitive for interacting with user accounts and message vaults. All message-related and user-authenticated endpoints require a JWT access token in the `Authorization: Bearer <YOUR_ACCESS_TOKEN>` header.\n\n### User Authentication\n\n*   **Register a New User:**\n    *   `POST /api/register/`\n    *   Payload: `username`, `email`, `password`\n    *   Response: Success message or validation errors.\n\n*   **Log In User:**\n    *   `POST /api/login/`\n    *   Payload: `email`, `password`\n    *   Response: JWT `access` token and basic user details.\n\n*   **Request Password Reset:**\n    *   `POST /api/password-reset/`\n    *   Payload: `email`\n    *   Response: Confirmation message indicating a reset link has been sent to the provided email.\n\n*   **Confirm Password Reset:**\n    *   `POST /api/password-reset-confirm/<uid>/<token>/`\n    *   Payload: `new_password`\n    *   Response: Confirmation message that password has been reset.\n\n### Message Management\n\n*   **Create a Secure Message:**\n    *   `POST /api/messages/`\n    *   Requires authentication.\n    *   Payload:\n        *   `title`: (string) Title of the message.\n        *   `content`: (string) The secret message content.\n        *   `passphrase`: (string, optional) A passphrase for decryption. If not provided, a system-generated key will be used, encrypted by the `MASTER_KEY`.\n        *   `unlock_after`: (datetime string, required) Format: `YYYY-MM-DD HH:MM:SS`. Message cannot be unlocked before this time. Must be in the future.\n        *   `self_destruct`: (boolean) If `true`, the message will be deleted after its first successful unlock.\n    *   Response: Details of the created message (title, unlock time, self-destruct status).\n\n*   **List Your Stored Messages:**\n    *   `GET /api/messages/`\n    *   Requires authentication.\n    *   Response: A list of messages associated with the authenticated user, including ID, title, a URL for unlocking, and creation timestamp.\n\n*   **Unlock and Read a Message:**\n    *   `POST /api/messages/{id}/unlock/`\n    *   Requires authentication.\n    *   Payload:\n        *   `passphrase`: (string, optional) Required if the message was created with a passphrase.\n    *   Response:\n        *   On success: `title` and `content` of the decrypted message.\n        *   If time-locked and too early: \"Available after...\" message.\n        *   If self-destructed or already viewed (and self-destruct enabled): \"Message has been destroyed\".\n        *   If incorrect passphrase: \"Decryption failed - invalid credentials\".\n\n## File Structure Summary\n\nThe project follows a standard Django project structure, with applications (`messagesvault` and `users`) separating concerns.\n\n```\n.\n├── smv/                     # Main Django project configuration\n│   ├── settings.py          # Project settings (database, installed apps, DRF config)\n│   ├── urls.py              # Main URL router\n│   ├── wsgi.py              # WSGI configuration\n│   └── asgi.py              # ASGI configuration\n├── messagesvault/           # Django app for secure message handling\n│   ├── models.py            # Defines the MessageVault model\n│   ├── views.py             # Handles API logic for message creation, listing, and unlocking\n│   ├── serializers.py       # Data serialization and decryption/encryption logic\n│   ├── migrations/          # Database migration files\n│   └── apps.py              # App configuration\n├── users/                   # Django app for user authentication and management\n│   ├── models.py            # (Could contain custom user model, currently default)\n│   ├── views.py             # Handles user registration, login, password reset\n│   ├── serializers.py       # Data serialization for user operations\n│   ├── migrations/          # Database migration files\n│   └── apps.py              # App configuration\n├── manage.py                # Django's command-line utility\n├── requirements.txt         # Project dependencies\n├── .env.example             # Example environment variables file (for .env)\n├── .gitignore               # Specifies intentionally untracked files to ignore\n└── readme.md                # This README file\n```\n\n## Important Notes\n\n*   **Security of `MASTER_KEY`**: The `MASTER_KEY` stored in your `.env` file is critical. In a production environment, ensure this key is securely managed (e.g., via environment variables, secret management services) and never committed to version control. If this key is compromised, all messages encrypted without a user-defined passphrase could be decrypted.\n*   **Development vs. Production:** The `DEBUG = True` setting in `smv/settings.py` is suitable for development. For production deployments, this should be set to `False`, and `ALLOWED_HOSTS` should be configured appropriately.\n*   **Time Zones:** Ensure your system's timezone and the `TIME_ZONE` setting in `smv/settings.py` are correctly configured, especially for time-locked messages.\n*   **CORS Configuration:** `CORS_ALLOW_ALL_ORIGINS = True` is set for development convenience. In production, configure `CORS_ALLOWED_ORIGINS` to a specific list of trusted domains.\n*   **Email Sending:** The password reset functionality relies on correctly configured SMTP settings in your `.env` file. Ensure these credentials are valid and that your email provider allows sending emails via SMTP.